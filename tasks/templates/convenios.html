{% extends "base.html" %}
{% load widget_tweaks %}

{% block content %}
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10/dist/sweetalert2.min.css">
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

<div class="container mt-5">
    <button onclick="history.back()" class="btn btn-success mb-3"><i class="fas fa-arrow-left"></i> Volver Atrás</button>
    <h2 class="mb-4">Gestión de Convenios para el Contrato ID: {{ contrato.id_contrato }}</h2>

    <div class="card mb-4">
        <div class="card-body">
            <form method="post" action="{% if modo == 'actualizar' %}{% url 'actualizar_convenio' convenio.ID_convenio %}{% else %}{% url 'crear_convenio' contrato.id_contrato %}{% endif %}">
                {% csrf_token %}
                {% for field in form %}
                <div class="form-group">
                    <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                    {{ field|add_class:"form-control" }}
                    {% if field.help_text %}
                        <small class="form-text text-muted">{{ field.help_text }}</small>
                    {% endif %}
                </div>
                {% endfor %}
                <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> {{ modo|title }}</button>
            </form>
        </div>
    </div>

    <div class="card">
        <div class="card-header"><h4 class="text-center">Listado de Convenios</h4></div>
        <div class="card-body">
            <table class="table table-bordered table-hover">
                <thead class="thead-dark">
                    <tr>
                        <th>ID Convenio</th>
                        <th>Fecha Inicio</th>
                        <th>Fecha Fin</th>
                        <th>Descripción</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for convenio in convenios %}
                    <tr>
                        <td>{{ convenio.ID_convenio }}</td>
                        <td>{{ convenio.fecha_inicio_formatted }}</td>
                        <td>{{ convenio.fecha_fin_formatted }}</td>
                        <td>{{ convenio.descripcion }}</td>
                        <td>
                            <a href="{% url 'actualizar_convenio' convenio.ID_convenio %}" class="btn btn-sm btn-warning"><i class="fas fa-edit"></i> Editar</a>
                            <form action="{% url 'eliminar_convenio' convenio.ID_convenio %}" method="post" style="display: inline;">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-sm btn-danger" onclick="return confirmDelete()"><i class="fas fa-trash-alt"></i> Eliminar</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        window.confirmDelete = function() {
            return Swal.fire({
                title: '¿Estás seguro?',
                text: "¡No podrás revertir esto!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: '¡Sí, bórralo!'
            }).then((result) => {
                return result.isConfirmed;
            });
        };
    });
</script>
{% endblock %}
